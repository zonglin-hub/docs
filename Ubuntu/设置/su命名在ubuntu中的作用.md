在Ubuntu中，`su`（**Switch User** 或 **Substitute User**）命令用于切换当前用户身份到另一个用户账户，最常用于切换到超级用户（root）。以下是它的核心作用和用法详解：

---

### **1. 核心作用**

- **切换用户身份**：临时以另一个用户（如 root 或其他用户）的权限运行命令或启动交互式Shell。
- **默认切换至 root**：若直接输入 `su` 而不指定用户名，默认尝试切换到 root 账户（需输入目标用户的密码）。
- **执行特权操作**：在需要管理员权限时，可通过切换到 root 执行敏感操作（但Ubuntu推荐优先使用`sudo`）。

---

### **2. 常见用法**

#### **基础命令**

| 命令 | 作用 | 示例输入密码 |
|------|------|--------------|
| `su` | 切换到 root 账户（需 root 密码） | root 的密码 |
| `su -` | 切换到 root 并加载其完整环境（如配置文件、路径） | root 的密码 |
| `su 用户名` | 切换到指定用户（需目标用户的密码） | 目标用户的密码 |
| `su - 用户名` | 切换到用户并加载其完整环境 | 目标用户的密码 |

#### **退出切换**

```bash
exit   # 或按 Ctrl+D，退出当前用户会话，返回原用户。
```

---

### **3. su 与 sudo 的区别**

| 特性 | `su` | `sudo` |
|------|------|--------|
| **密码要求** | 需目标用户的密码 | 需当前用户的密码 |
| **权限范围** | 完全切换到目标用户（如 root） | 以 root 权限执行单条命令 |
| **默认配置** | root 账户默认禁用（Ubuntu） | 用户需在 `sudoers` 列表 |
| **安全性** | 需暴露 root 密码 | 更细粒度控制，审计友好 |

---

### **4. Ubuntu 中的注意事项**

- **root 账户默认禁用**：Ubuntu 安装后未设置 root 密码，直接运行 `su` 会失败。
    - 解决方法：使用 `sudo -i` 或 `sudo su`（以当前用户权限临时切换至 root，无需 root 密码）。
- **推荐使用 sudo**：Ubuntu 鼓励通过 `sudo` 执行管理员命令，而非直接启用 root。
- **启用 root 账户（不推荐）**：

  ```bash
  sudo passwd root  # 设置 root 密码（谨慎操作）
  ```

---

### **5. 示例场景**

1. **切换到普通用户（如 `john`）**：

   ```bash
   su - john   # 输入 john 的密码
   ```

2. **临时以 root 安装软件（需已启用 root）**：

   ```bash
   su
   apt install nginx
   exit
   ```

3. **使用 `sudo` 替代 `su`（更安全）**：

   ```bash
   sudo apt update          # 单条命令提权
   sudo -i                 # 启动 root 的交互式 Shell（无需 root 密码）
   ```

---

### **6. 环境变量差异**

- **`su` vs `su -`**：
    - `su`：保留当前用户的环境变量。
    - `su -`（或 `su -l`）：模拟完整登录，加载目标用户的配置文件（如 `~/.bashrc`）。

---

### **总结**

- **`su` 的核心用途**：切换用户身份（尤其是 root），需目标用户的密码。
- **Ubuntu 最佳实践**：优先使用 `sudo` 避免直接操作 root，除非有特殊需求。
- **安全提示**：启用 root 账户可能增加风险，建议仅在必要时使用 `su`。
