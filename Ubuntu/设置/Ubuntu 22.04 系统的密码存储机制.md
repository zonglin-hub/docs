Ubuntu系统的密码存储机制是一个多层次的安全体系，结合了文件存储、加密算法和策略管理。以下是其核心要点的详细分步解释：

---

### __1. 用户信息与密码存储位置__

- __/etc/passwd__  
  存储用户的基本信息（如用户名、UID、主目录等），但 __不保存密码__。该文件全局可读，出于安全考虑，密码字段通常为占位符（如`x`）。
  
- __/etc/shadow__  
  存储加密后的密码哈希及密码策略信息，仅 __root用户可读写__。每个条目的格式为：  

  ```text
  用户名:加密密码:上次修改天数:最小天数:最大天数:警告期:失效期:保留字段
  ```

---

### __2. 密码加密机制__

- __哈希算法与盐值__  
    - 密码通过 __单向哈希函数__（如SHA-512、yescrypt）处理，生成不可逆的哈希值。
    - 使用 __随机盐值（salt）__，确保相同密码的哈希结果不同，抵御彩虹表攻击。
    - 哈希值格式为：`$算法标识$盐值$哈希值`  
        - 例如：`$6$salt123$...` 表示SHA-512，`$y$` 表示yescrypt（Ubuntu 22.04+默认）。

- __默认算法的演变__  
    - 旧版本（如Ubuntu 20.04）：默认使用SHA-512（标识符`$6$`）。
    - 新版本（如Ubuntu 22.04+）：采用更安全的 __yescrypt__（标识符`$y$`），支持更高的计算成本参数，增强抗暴力破解能力。

---

### __3. 密码策略管理__

- __/etc/login.defs__  
  配置密码有效期规则（如`PASS_MAX_DAYS`定义密码最长使用期限）。

- __PAM（Pluggable Authentication Modules）__  
    - 通过`/etc/pam.d/common-password`等配置文件定义密码复杂度要求。
    - 集成`libpam-pwquality`模块，检查密码长度、字符多样性等（配置见`/etc/security/pwquality.conf`）。

- __密码修改与验证流程__  
    - 用户执行`passwd`命令时，系统生成新盐值并加密密码，更新`/etc/shadow`。
    - 登录时，系统将输入密码与存储的盐值组合，重新计算哈希值进行比对。

---

### __4. 安全增强措施__

- __防止暴力破解__  
    - 使用`pam_faillock`或`pam_tally2`限制连续失败登录尝试。
  
- __密码老化策略__  
  在`/etc/shadow`中设置密码的最短/最长使用期限，强制用户定期更换密码。

- __特权分离__  
  `sudo`权限通过`/etc/sudoers`管理，与密码存储解耦，减少权限滥用风险。

---

### __示例：Shadow条目解析__

假设条目为：  
`user:$y$j9T$8sF45S3T2D...$X3vz7...:19285:0:90:7:::`  

- __算法标识__：`$y$`表示yescrypt。  
- __盐值__：`j9T$8sF45S3T2D...`（实际更长）。  
- __哈希值__：`X3vz7...`（实际更长）。  
- __策略字段__：密码上次修改为第19285天，最大有效期90天，到期前7天发出警告。

---

### __总结__

Ubuntu通过将密码哈希安全存储于`/etc/shadow`、使用强哈希算法（如yescrypt）结合盐值、以及灵活的PAM策略，构建了高效的密码管理体系。同时，密码生命周期策略和防暴力破解机制进一步提升了系统安全性。这一机制的核心在于 __单向加密、盐值随机化、严格的访问控制__，确保用户凭证的机密性与完整性。
